
<section class="mb-5 position-relative">
  <h5 class="text-primary">ğŸ”— Ø±Ø¨Ø· Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ®ØµÙŠØµ Ù…Ø¹ Ø§Ù„Ø£ØµÙ†Ø§Ù</h5>

  <!-- Ù…ÙƒØ§Ù† Ø¸Ù‡ÙˆØ± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙÙ„Ø§Ø´ Ø¨Ø¯ÙˆÙ† Ø±ÙØ¹ Ø§Ù„ØµÙØ­Ø© -->
  <div id="flash-message" class="position-fixed top-0 end-0 p-3" style="z-index: 1050;"></div>

  <form method="POST" onsubmit="return confirm('ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±Ø¨Ø·ØŸ');">
    <div class="mb-3">
      <label for="link_custom_item_id" class="form-label">Ø§Ø®ØªØ± ØµÙ†Ù:</label>
      <select id="link_custom_item_id" name="link_custom_item_id" class="form-select" required>
        <option disabled selected>Ø§Ø®ØªØ± ØµÙ†ÙÙ‹Ø§</option>
        {% for item in items %}
          <option value="{{ item.id }}">{{ item.name }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">Ø§Ø®ØªØ± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª:</label>
      <div class="d-flex flex-wrap gap-3">
        {% for option in options %}
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="custom_option_{{ option.id }}"
              name="customizable_option_ids"
              value="{{ option.id }}"
            >
            <label class="form-check-label" for="custom_option_{{ option.id }}">
              {% set matched = customizables | selectattr('id', 'equalto', option.customizable_ingredient_id) | list %}
              {% if matched|length > 0 %}
                {{ matched[0].name }}:
              {% else %}
                (Ù…ÙƒÙˆÙ† ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ):
              {% endif %}
              {{ option.name }}
            </label>
          </div>
        {% endfor %}
      </div>
    </div>

    <button type="submit" name="action" value="link_custom" class="btn btn-warning">ğŸ”— Ø±Ø¨Ø· Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª</button>
  </form>

  {% if item_custom_links %}
  <table class="table table-striped mt-3 text-center">
    <thead class="table-secondary">
      <tr><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø®ÙŠØ§Ø±</th><th>Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø¨Ø·</th></tr>
    </thead>
    <tbody>
      {% for link in item_custom_links %}
      <tr>
        <td>{{ link.item_name }}</td>
        <td>{{ link.option_name }}</td>
        <td>
          <form method="POST" onsubmit="return confirm('ØªØ£ÙƒÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø¨Ø·ØŸ');" style="display:inline;">
            <input type="hidden" name="unlink_custom_item_id" value="{{ link.item_id }}">
            <input type="hidden" name="unlink_custom_option_id" value="{{ link.option_id }}">
            <button name="action" value="unlink_custom" class="btn btn-outline-danger btn-sm">âŒ</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="text-center text-muted mt-3">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø· Ù…Ø¶Ø§ÙØ© Ø¨Ø¹Ø¯.</div>
  {% endif %}
</section>

<!-- Ø³ÙƒØ±Ø¨Øª Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙÙ„Ø§Ø´ Ø¨Ø¯ÙˆÙ† Ø±ÙØ¹ Ø§Ù„ØµÙØ­Ø© -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        let flashContainer = document.getElementById('flash-message');
        {% for message in messages %}
          let toast = document.createElement('div');
          toast.className = 'toast align-items-center text-bg-success border-0 show mb-2';
          toast.setAttribute('role', 'alert');
          toast.setAttribute('aria-live', 'assertive');
          toast.setAttribute('aria-atomic', 'true');
          toast.innerHTML = `
            <div class="d-flex">
              <div class="toast-body">
                {{ message }}
              </div>
              <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
          `;
          flashContainer.appendChild(toast);
          setTimeout(() => { toast.classList.remove('show'); toast.remove(); }, 3000);
        {% endfor %}
      {% endif %}
    {% endwith %}
  });
</script>
